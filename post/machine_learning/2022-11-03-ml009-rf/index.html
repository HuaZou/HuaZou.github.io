<!doctype html><!-- This site was created with Wowchemy. https://www.wowchemy.com --><!-- Last Published: April 27, 2023 --><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.7.0 for Hugo"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><link rel=stylesheet href=/css/vendor-bundle.min.16f785cdb553c8c4431db6775122af35.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/academicons@1.9.2/css/academicons.min.css integrity="sha512-KlJCpRsLf+KKu2VQa5vmRuClRFjxc5lXO03ixZt82HZUk41+1I0bD8KBSA0fY290ayMfWYI9udIqeOWSu1/uZg==" crossorigin=anonymous media=print onload='this.media="all"'><link rel=stylesheet href=/css/wowchemy.e5d7adca760216d3b7e28ea434e81f6f.css><link rel=stylesheet href=/css/libs/chroma/github-light.min.css title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=/css/libs/chroma/dracula.min.css title=hl-dark media=print onload='this.media="all"' disabled><script async src="https://www.googletagmanager.com/gtag/js?id=UA-162525500-1"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}function trackOutboundLink(e,t){gtag("event","click",{event_category:"outbound",event_label:e,transport_type:"beacon",event_callback:function(){t!=="_blank"&&(document.location=e)}}),console.debug("Outbound link clicked: "+e)}function onClickCallback(e){if(e.target.tagName!=="A"||e.target.host===window.location.host)return;trackOutboundLink(e.target,e.target.getAttribute("target"))}gtag("js",new Date),gtag("config","UA-162525500-1",{}),gtag("set",{cookie_flags:"SameSite=None;Secure"}),document.addEventListener("click",onClickCallback,!1)</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?67583aee7371a754cff04fa0a471bca3",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><meta name=author content="Hua Zou"><meta name=description content="Predictive Model using Random Forest on gut microbiota."><link rel=alternate hreflang=en-us href=https://zouhua.top/post/machine_learning/2022-11-03-ml009-rf/><link rel=canonical href=https://zouhua.top/post/machine_learning/2022-11-03-ml009-rf/><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hub9a637e5d84e6d4c134f91fa57903eec_55838_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=/media/icon_hub9a637e5d84e6d4c134f91fa57903eec_55838_180x180_fill_lanczos_center_3.png><meta name=theme-color content="#1565c0"><meta property="twitter:card" content="summary"><meta property="twitter:site" content="@Hua Zou"><meta property="twitter:creator" content="@Hua Zou"><meta property="twitter:image" content="https://zouhua.top/media/icon_hub9a637e5d84e6d4c134f91fa57903eec_55838_512x512_fill_lanczos_center_3.png"><meta property="og:site_name" content="Hua' Cabin"><meta property="og:url" content="https://zouhua.top/post/machine_learning/2022-11-03-ml009-rf/"><meta property="og:title" content="Machine Learning on gut microbiota of patients with Colorectal cancer (9) | Hua' Cabin"><meta property="og:description" content="Predictive Model using Random Forest on gut microbiota."><meta property="og:image" content="https://zouhua.top/media/icon_hub9a637e5d84e6d4c134f91fa57903eec_55838_512x512_fill_lanczos_center_3.png"><meta property="og:locale" content="en-us"><meta property="article:published_time" content="2022-11-03T20:13:14+00:00"><meta property="article:modified_time" content="2022-11-03T22:13:14+00:00"><title>Machine Learning on gut microbiota of patients with Colorectal cancer (9) | Hua' Cabin</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=d960b367878d521f361075b27ae9a06f><script src=/js/wowchemy-init.min.ec9d49ca50e4b80bdb08f0417a28ed84.js></script><div class="page-header header--fixed"><header><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/>Hua' Cabin</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label="Toggle navigation">
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/>Hua' Cabin</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/#about><span>Home</span></a></li><li class=nav-item><a class=nav-link href=/#posts><span>Posts</span></a></li><li class=nav-item><a class=nav-link href=/#experience><span>Experience</span></a></li><li class=nav-item><a class=nav-link href=/#publications><span>Publications</span></a></li><li class=nav-item><a class=nav-link href=/#contact><span>Contact</span></a></li><li class=nav-item><a class=nav-link href=/#bookdown><span>Bookdown</span></a></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=Search><i class="fas fa-search" aria-hidden=true></i></a></li><li class="nav-item dropdown theme-dropdown"><a href=# class=nav-link data-toggle=dropdown aria-haspopup=true aria-label="Display preferences"><i class="fas fa-moon" aria-hidden=true></i></a><div class=dropdown-menu><a href=# class="dropdown-item js-set-theme-light"><span>Light</span></a>
<a href=# class="dropdown-item js-set-theme-dark"><span>Dark</span></a>
<a href=# class="dropdown-item js-set-theme-auto"><span>Automatic</span></a></div></li></ul></div></nav></header></div><div class=page-body><div class="container-fluid docs"><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 docs-sidebar"><form class="docs-search d-flex align-items-center"><button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type=button data-toggle=collapse data-target=#docs-nav aria-controls=docs-nav aria-expanded=false aria-label="Toggle section navigation"><div class=d-flex><span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">Posts</span>
<span><i class="fas fa-chevron-down"></i></span></div></button></form><nav class="collapse docs-links" id=docs-nav><ul class="nav docs-sidenav"><li><a href=/post/><i class="fas fa-arrow-left pr-1"></i>Posts</a></li></ul><li class=active><a href=/post/machine_learning/2022-11-03-ml009-rf/>Machine Learning on gut microbiota of patients with Colorectal cancer (9)</a></li></nav></div><div class="d-none d-xl-block col-xl-2 docs-toc"><ul class="nav toc-top"><li><a href=# id=back_to_top class=docs-toc-title>Contents</a></li></ul><nav id=TableOfContents><ul><li><a href=#important-parameters>Important Parameters</a></li><li><a href=#loading-libraries>Loading libraries</a></li><li><a href=#importing-data>Importing data</a></li><li><a href=#missing-values-or-occurrence>Missing values or Occurrence</a></li><li><a href=#class-balance>Class balance</a></li><li><a href=#distribution-of-features>Distribution of features</a></li><li><a href=#correlation>Correlation</a></li><li><a href=#feature-selection>Feature Selection</a></li><li><a href=#principal-component-analysis>Principal component analysis</a></li><li><a href=#transforming-the-string-label-into-numeric-lable>Transforming the string label into numeric lable</a></li><li><a href=#creating-train-and-test-sets>Creating Train and Test Sets</a></li><li><a href=#fitting-random-forest>Fitting Random Forest</a></li><li><a href=#out-of-bag-error-rate>Out of Bag Error Rate</a></li><li><a href=#building-model-of-optimal-parameters>Building model of optimal parameters</a><ul><li><a href=#the-performance-of-model-on-testdata>The performance of model on testData</a></li></ul></li><li><a href=#roc-curve-metrics>ROC Curve Metrics</a></li><li><a href=#classification-report>Classification Report</a></li><li><a href=#feature-importance>Feature Importance</a><ul><li><a href=#selecting-features-by-importance>Selecting features by importance</a></li></ul></li><li><a href=#rebuilding-model>Rebuilding model</a></li><li><a href=#summary>Summary</a></li><li><a href=#reference>Reference</a></li></ul></nav></div><main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role=main><div class=docs-article-container></div><div class=docs-article-container><h1>Machine Learning on gut microbiota of patients with Colorectal cancer (9)</h1><article class=article-style><h1 id=predictive-model-using-random-forest>Predictive Model using Random Forest</h1><p>Random Forest, a ensemble machine learning algorithm with multiple decision trees could be used for classification or regression algorithm, and it has an elegant way of dealing with nonlinear or linear data.</p><blockquote><p>Random forest aims to reduce the previously mentioned correlation issue by choosing only a subsample of the feature space at each split. Essentially, it aims to make the trees de-correlated and prune the trees by setting a stopping criteria for node splits, which I will cover in more detail later.</p></blockquote><h2 id=important-parameters>Important Parameters</h2><ul><li><strong>number of estimators</strong>: the number of trees for constructing forest.</li><li><strong>max depth of each tree</strong>: the number of features per decision tree.</li><li><strong>max features per split</strong>: it affects the performance of the whole dicision tree.</li></ul><p><strong>estimator</strong> also termed tree and depth control the complexity of the model, with larger <em>estimators</em> would result in better and high density forest and maximum depth helps fighting with overfitting.</p><p><code>Random Forest doesn't require careful preprocessing such as normalization of data</code>. Standardization is an important requirement for many classification models that should be handled when implementing pre-processing. Some models (like neural networks) can perform poorly if pre-processing isn&rsquo;t considered, so the <code>describe()</code> function is a good indicator for standardization. Fortunately, random forest does not require any pre-processing.</p><h2 id=loading-libraries>Loading libraries</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>%</span><span class=n>matplotlib</span> <span class=n>inline</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>matplotlib.pyplot</span> <span class=k>as</span> <span class=nn>plt</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.preprocessing</span> <span class=kn>import</span> <span class=n>LabelEncoder</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.model_selection</span> <span class=kn>import</span> <span class=n>train_test_split</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.ensemble</span> <span class=kn>import</span> <span class=n>RandomForestClassifier</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.metrics</span> <span class=kn>import</span> <span class=n>accuracy_score</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.metrics</span> <span class=kn>import</span> <span class=n>roc_curve</span><span class=p>,</span> <span class=n>auc</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.metrics</span> <span class=kn>import</span> <span class=n>confusion_matrix</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.model_selection</span> <span class=kn>import</span> <span class=n>cross_val_score</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.metrics</span> <span class=kn>import</span> <span class=n>classification_report</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.model_selection</span> <span class=kn>import</span> <span class=n>GridSearchCV</span><span class=p>,</span> <span class=n>train_test_split</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>seaborn</span> <span class=k>as</span> <span class=nn>sns</span>
</span></span><span class=line><span class=cl><span class=c1>#plt.style.use(&#39;fivethirtyeight&#39;)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>style</span><span class=o>.</span><span class=n>use</span><span class=p>(</span><span class=s1>&#39;fivethirtyeight&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>set_style</span><span class=p>(</span><span class=s2>&#34;darkgrid&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>rcParams</span><span class=p>[</span><span class=s1>&#39;figure.figsize&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=mi>8</span><span class=p>,</span> <span class=mi>4</span><span class=p>)</span>
</span></span></code></pre></div><h2 id=importing-data>Importing data</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=s1>&#39;&#39;&#39;
</span></span></span><span class=line><span class=cl><span class=s1># raw data
</span></span></span><span class=line><span class=cl><span class=s1>data_df = pd.read_table(&#39;./dataset/MergeData.tsv&#39;, sep=&#34;</span><span class=se>\t</span><span class=s1>&#34;, index_col=0)
</span></span></span><span class=line><span class=cl><span class=s1>data = data_df.reset_index(drop=True)
</span></span></span><span class=line><span class=cl><span class=s1>data.head()
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1># significant species
</span></span></span><span class=line><span class=cl><span class=s1>data_df = pd.read_table(&#39;./dataset/MergeData_clr_signif.tsv&#39;, sep=&#34;</span><span class=se>\t</span><span class=s1>&#34;, index_col=0)
</span></span></span><span class=line><span class=cl><span class=s1>data = data_df.reset_index(drop=True)
</span></span></span><span class=line><span class=cl><span class=s1>data.head()
</span></span></span><span class=line><span class=cl><span class=s1>&#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># CLR-transformed data</span>
</span></span><span class=line><span class=cl><span class=n>data_df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_table</span><span class=p>(</span><span class=s1>&#39;./dataset/MergeData_clr.tsv&#39;</span><span class=p>,</span> <span class=n>sep</span><span class=o>=</span><span class=s2>&#34;</span><span class=se>\t</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>index_col</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=n>data_df</span><span class=o>.</span><span class=n>reset_index</span><span class=p>(</span><span class=n>drop</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>data</span><span class=o>.</span><span class=n>head</span><span class=p>()</span>
</span></span></code></pre></div><div><style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}<pre><code>.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</code></pre><p></style></p><table border=1 class=dataframe><thead><tr style=text-align:right><th></th><th>disease</th><th>s__Bacteroides_plebeius</th><th>s__Bacteroides_dorei</th><th>s__Faecalibacterium_prausnitzii</th><th>s__Eubacterium_eligens</th><th>s__Bacteroides_ovatus</th><th>s__Parabacteroides_distasonis</th><th>s__Ruminococcus_gnavus</th><th>s__Phascolarctobacterium_faecium</th><th>s__Bacteroides_uniformis</th><th>...</th><th>s__Bacteroides_finegoldii</th><th>s__Haemophilus_sp_HMSC71H05</th><th>s__Clostridium_saccharolyticum</th><th>s__Streptococcus_anginosus_group</th><th>s__Streptococcus_sp_A12</th><th>s__Klebsiella_pneumoniae</th><th>s__Bacteroides_coprocola</th><th>s__Ruminococcus_lactaris</th><th>s__Turicimonas_muris</th><th>s__Proteobacteria_bacterium_CAG_139</th></tr></thead><tbody><tr><th>0</th><td>healthy</td><td>10.262146</td><td>8.532694</td><td>7.729839</td><td>7.605931</td><td>7.477464</td><td>7.267232</td><td>7.074996</td><td>6.832596</td><td>6.738413</td><td>...</td><td>-3.441779</td><td>-3.441779</td><td>-3.441779</td><td>-3.441779</td><td>-3.441779</td><td>-3.441779</td><td>-3.441779</td><td>-3.441779</td><td>-3.441779</td><td>-3.441779</td></tr><tr><th>1</th><td>healthy</td><td>7.609333</td><td>4.466872</td><td>6.654823</td><td>4.236672</td><td>4.697277</td><td>3.518645</td><td>2.603642</td><td>-3.929140</td><td>5.619399</td><td>...</td><td>-3.929140</td><td>-3.929140</td><td>-3.929140</td><td>-3.929140</td><td>-3.929140</td><td>-3.929140</td><td>-3.929140</td><td>-3.929140</td><td>-3.929140</td><td>-3.929140</td></tr><tr><th>2</th><td>healthy</td><td>8.411267</td><td>7.884081</td><td>7.668467</td><td>-3.379905</td><td>6.577229</td><td>6.474488</td><td>6.883446</td><td>-3.379905</td><td>6.725545</td><td>...</td><td>-3.379905</td><td>-3.379905</td><td>-3.379905</td><td>-3.379905</td><td>-3.379905</td><td>-3.379905</td><td>-3.379905</td><td>-3.379905</td><td>-3.379905</td><td>-3.379905</td></tr><tr><th>3</th><td>healthy</td><td>6.261269</td><td>6.939669</td><td>5.819509</td><td>4.064784</td><td>4.026179</td><td>7.227381</td><td>3.407265</td><td>-3.632294</td><td>6.170285</td><td>...</td><td>-3.632294</td><td>-3.632294</td><td>-3.632294</td><td>-3.632294</td><td>-3.632294</td><td>-3.632294</td><td>-3.632294</td><td>-3.632294</td><td>-3.632294</td><td>-3.632294</td></tr><tr><th>4</th><td>CRC</td><td>-0.026692</td><td>5.697435</td><td>3.808831</td><td>4.253082</td><td>4.284986</td><td>5.784833</td><td>6.384592</td><td>-5.007660</td><td>5.492187</td><td>...</td><td>4.187313</td><td>2.872359</td><td>2.219946</td><td>0.713786</td><td>-5.007660</td><td>-5.007660</td><td>-5.007660</td><td>-5.007660</td><td>-5.007660</td><td>-5.007660</td></tr></tbody></table><p>5 rows × 152 columns</p></div><h2 id=missing-values-or-occurrence>Missing values or Occurrence</h2><p>the occurrence per features</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1>#data.iloc[:, 1:].apply(lambda x: np.count_nonzero(x)/len(x), axis=0)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Here&#39;s the dimensions of our data frame:</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>data</span><span class=o>.</span><span class=n>shape</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Here&#39;s the data types of our columns:</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>data</span><span class=o>.</span><span class=n>dtypes</span><span class=p>)</span>
</span></span></code></pre></div><pre><code>Here's the dimensions of our data frame:
 (504, 152)
Here's the data types of our columns:
 disease                                 object
s__Bacteroides_plebeius                float64
s__Bacteroides_dorei                   float64
s__Faecalibacterium_prausnitzii        float64
s__Eubacterium_eligens                 float64
                                        ...   
s__Klebsiella_pneumoniae               float64
s__Bacteroides_coprocola               float64
s__Ruminococcus_lactaris               float64
s__Turicimonas_muris                   float64
s__Proteobacteria_bacterium_CAG_139    float64
Length: 152, dtype: object
</code></pre><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>data</span><span class=o>.</span><span class=n>describe</span><span class=p>()</span>
</span></span></code></pre></div><div><style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}<pre><code>.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</code></pre><p></style></p><table border=1 class=dataframe><thead><tr style=text-align:right><th></th><th>s__Bacteroides_plebeius</th><th>s__Bacteroides_dorei</th><th>s__Faecalibacterium_prausnitzii</th><th>s__Eubacterium_eligens</th><th>s__Bacteroides_ovatus</th><th>s__Parabacteroides_distasonis</th><th>s__Ruminococcus_gnavus</th><th>s__Phascolarctobacterium_faecium</th><th>s__Bacteroides_uniformis</th><th>s__Bifidobacterium_longum</th><th>...</th><th>s__Bacteroides_finegoldii</th><th>s__Haemophilus_sp_HMSC71H05</th><th>s__Clostridium_saccharolyticum</th><th>s__Streptococcus_anginosus_group</th><th>s__Streptococcus_sp_A12</th><th>s__Klebsiella_pneumoniae</th><th>s__Bacteroides_coprocola</th><th>s__Ruminococcus_lactaris</th><th>s__Turicimonas_muris</th><th>s__Proteobacteria_bacterium_CAG_139</th></tr></thead><tbody><tr><th>count</th><td>504.000000</td><td>504.000000</td><td>504.000000</td><td>504.000000</td><td>504.000000</td><td>504.000000</td><td>504.000000</td><td>504.000000</td><td>504.000000</td><td>504.000000</td><td>...</td><td>504.000000</td><td>504.000000</td><td>504.000000</td><td>504.000000</td><td>504.000000</td><td>504.000000</td><td>504.000000</td><td>504.000000</td><td>504.000000</td><td>504.000000</td></tr><tr><th>mean</th><td>1.256825</td><td>2.927299</td><td>5.667281</td><td>1.616724</td><td>3.307470</td><td>4.681808</td><td>3.345991</td><td>-0.456599</td><td>6.187024</td><td>2.897217</td><td>...</td><td>-1.050304</td><td>-2.053572</td><td>-1.841538</td><td>-1.708054</td><td>-2.299261</td><td>-1.441218</td><td>-0.784937</td><td>-1.340681</td><td>-2.291258</td><td>-1.626394</td></tr><tr><th>std</th><td>5.247064</td><td>4.821565</td><td>2.990958</td><td>4.504301</td><td>3.605593</td><td>3.569784</td><td>3.994830</td><td>3.804094</td><td>2.888385</td><td>3.702841</td><td>...</td><td>3.734545</td><td>2.382407</td><td>2.704140</td><td>2.416765</td><td>1.869589</td><td>3.354881</td><td>4.252129</td><td>3.569669</td><td>2.030418</td><td>2.930831</td></tr><tr><th>min</th><td>-5.286399</td><td>-4.671094</td><td>-3.893930</td><td>-4.943353</td><td>-4.341294</td><td>-4.135735</td><td>-4.746337</td><td>-5.286399</td><td>-3.742171</td><td>-4.520503</td><td>...</td><td>-5.061605</td><td>-4.993406</td><td>-5.286399</td><td>-4.993406</td><td>-5.286399</td><td>-5.007660</td><td>-5.286399</td><td>-5.286399</td><td>-5.286399</td><td>-5.286399</td></tr><tr><th>25%</th><td>-3.319519</td><td>-2.510933</td><td>5.642812</td><td>-2.901603</td><td>1.786175</td><td>4.290055</td><td>0.991982</td><td>-3.455534</td><td>5.611716</td><td>0.599582</td><td>...</td><td>-3.503629</td><td>-3.597303</td><td>-3.602112</td><td>-3.403795</td><td>-3.571865</td><td>-3.549059</td><td>-3.582676</td><td>-3.576873</td><td>-3.602045</td><td>-3.556058</td></tr><tr><th>50%</th><td>-2.118272</td><td>4.413118</td><td>6.563336</td><td>2.013259</td><td>4.218514</td><td>5.628107</td><td>4.270669</td><td>-2.534482</td><td>6.872015</td><td>4.003185</td><td>...</td><td>-2.903888</td><td>-2.991046</td><td>-2.946014</td><td>-2.678076</td><td>-2.966351</td><td>-2.945052</td><td>-2.903888</td><td>-2.943603</td><td>-2.989558</td><td>-2.852131</td></tr><tr><th>75%</th><td>6.963744</td><td>7.264553</td><td>7.317980</td><td>6.046958</td><td>5.716982</td><td>6.921791</td><td>6.315415</td><td>3.635188</td><td>7.934838</td><td>5.439522</td><td>...</td><td>0.770320</td><td>-1.707308</td><td>-1.562814</td><td>-0.247675</td><td>-1.726005</td><td>-0.103514</td><td>2.553523</td><td>-1.704935</td><td>-1.874005</td><td>-0.813035</td></tr><tr><th>max</th><td>11.092608</td><td>11.372814</td><td>10.350223</td><td>10.790908</td><td>10.995056</td><td>10.776272</td><td>10.795287</td><td>7.801161</td><td>10.596756</td><td>11.050896</td><td>...</td><td>9.794324</td><td>7.783317</td><td>6.769775</td><td>6.339786</td><td>5.843264</td><td>10.786159</td><td>10.152641</td><td>9.121991</td><td>5.404423</td><td>8.287044</td></tr></tbody></table><p>8 rows × 151 columns</p></div><h2 id=class-balance>Class balance</h2><p>Displaying the counts by values and plot</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>print_rate</span><span class=p>(</span><span class=n>data_frame</span><span class=p>,</span> <span class=n>col</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>col_vals</span> <span class=o>=</span> <span class=n>data_frame</span><span class=p>[</span><span class=n>col</span><span class=p>]</span><span class=o>.</span><span class=n>value_counts</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>col_vals</span> <span class=o>=</span> <span class=n>col_vals</span><span class=o>.</span><span class=n>reset_index</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>col_vals</span><span class=p>[</span><span class=s1>&#39;index&#39;</span><span class=p>])</span> <span class=o>&gt;</span> <span class=mi>20</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Warning: values in column are more than 20 </span><span class=se>\n</span><span class=s1>Please try a column with lower value counts!&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>f</span> <span class=o>=</span> <span class=k>lambda</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>:</span> <span class=mi>100</span> <span class=o>*</span> <span class=p>(</span><span class=n>x</span> <span class=o>/</span> <span class=nb>sum</span><span class=p>(</span><span class=n>y</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>col_vals</span><span class=p>[</span><span class=s1>&#39;index&#39;</span><span class=p>])):</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;</span><span class=si>{0}</span><span class=s1> accounts for </span><span class=si>{1:.2f}% o</span><span class=s1>f the </span><span class=si>{2}</span><span class=s1> column&#39;</span>\
</span></span><span class=line><span class=cl>                      <span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>col_vals</span><span class=p>[</span><span class=s1>&#39;index&#39;</span><span class=p>][</span><span class=n>i</span><span class=p>],</span> <span class=n>f</span><span class=p>(</span><span class=n>col_vals</span><span class=p>[</span><span class=n>col</span><span class=p>]</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=n>col_vals</span><span class=p>[</span><span class=n>col</span><span class=p>]),</span> <span class=n>col</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>KeyError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;</span><span class=si>{0}</span><span class=s1>: Not found&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>e</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Please choose the right column name!&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>print_rate</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=s1>&#39;disease&#39;</span><span class=p>)</span>
</span></span></code></pre></div><pre><code>CRC accounts for 51.19% of the disease column
healthy accounts for 48.81% of the disease column
</code></pre><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>set_style</span><span class=p>(</span><span class=s2>&#34;white&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>set_context</span><span class=p>({</span><span class=s2>&#34;figure.figsize&#34;</span><span class=p>:</span> <span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>)})</span>
</span></span><span class=line><span class=cl><span class=n>ax</span> <span class=o>=</span> <span class=n>sns</span><span class=o>.</span><span class=n>countplot</span><span class=p>(</span><span class=n>x</span> <span class=o>=</span> <span class=s1>&#39;disease&#39;</span><span class=p>,</span> <span class=n>data</span> <span class=o>=</span> <span class=n>data</span><span class=p>,</span> <span class=n>label</span> <span class=o>=</span> <span class=s2>&#34;Count&#34;</span><span class=p>,</span> <span class=n>palette</span> <span class=o>=</span> <span class=s2>&#34;Set1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ax</span><span class=o>.</span><span class=n>bar_label</span><span class=p>(</span><span class=n>ax</span><span class=o>.</span><span class=n>containers</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>15</span><span class=p>)</span>
</span></span></code></pre></div><pre><code>[Text(0, 0, '246'), Text(0, 0, '258')]
</code></pre><p>​<figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://raw.githubusercontent.com/HuaZou/Image_Host/main/img/08.PredictiveModelRandomForest_11_1.png alt loading=lazy data-zoomable></div></div></figure>​</p><h2 id=distribution-of-features>Distribution of features</h2><p>Taking a look at the distribution of each feature and see how they are different between &lsquo;healthy&rsquo; and &lsquo;CRC&rsquo;. To see the distribution of multiple variables, using violin plot, swarm plot or box plot.</p><p>Here, we choose 10 features to visualization</p><ul><li>standardizing data and gathering data into long data</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.preprocessing</span> <span class=kn>import</span> <span class=n>StandardScaler</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>df_features</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>iloc</span><span class=p>[:,</span> <span class=mi>1</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>scaler</span> <span class=o>=</span> <span class=n>StandardScaler</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>scaler</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>df_features</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>features_scaled</span> <span class=o>=</span> <span class=n>scaler</span><span class=o>.</span><span class=n>transform</span><span class=p>(</span><span class=n>df_features</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>features_scaled</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>features_scaled</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                               <span class=n>columns</span><span class=o>=</span><span class=n>df_features</span><span class=o>.</span><span class=n>columns</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>data_scaled</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>concat</span><span class=p>([</span><span class=n>features_scaled</span><span class=p>,</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;disease&#39;</span><span class=p>]],</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>data_scaled_melt</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>melt</span><span class=p>(</span><span class=n>data_scaled</span><span class=p>,</span> <span class=n>id_vars</span><span class=o>=</span><span class=s1>&#39;disease&#39;</span><span class=p>,</span> <span class=n>var_name</span><span class=o>=</span><span class=s1>&#39;features&#39;</span><span class=p>,</span> <span class=n>value_name</span><span class=o>=</span><span class=s1>&#39;value&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>data_scaled_melt</span><span class=o>.</span><span class=n>head</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
</span></span></code></pre></div><div><style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}<pre><code>.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</code></pre><p></style></p><table border=1 class=dataframe><thead><tr style=text-align:right><th></th><th>disease</th><th>features</th><th>value</th></tr></thead><tbody><tr><th>0</th><td>healthy</td><td>s__Bacteroides_plebeius</td><td>1.717964</td></tr><tr><th>1</th><td>healthy</td><td>s__Bacteroides_plebeius</td><td>1.211882</td></tr><tr><th>2</th><td>healthy</td><td>s__Bacteroides_plebeius</td><td>1.364868</td></tr><tr><th>3</th><td>healthy</td><td>s__Bacteroides_plebeius</td><td>0.954709</td></tr><tr><th>4</th><td>CRC</td><td>s__Bacteroides_plebeius</td><td>-0.244859</td></tr><tr><th>5</th><td>CRC</td><td>s__Bacteroides_plebeius</td><td>-0.364734</td></tr><tr><th>6</th><td>CRC</td><td>s__Bacteroides_plebeius</td><td>0.002748</td></tr><tr><th>7</th><td>CRC</td><td>s__Bacteroides_plebeius</td><td>1.222586</td></tr><tr><th>8</th><td>CRC</td><td>s__Bacteroides_plebeius</td><td>0.547317</td></tr><tr><th>9</th><td>CRC</td><td>s__Bacteroides_plebeius</td><td>-1.182821</td></tr></tbody></table></div><ul><li>violin plot</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>violin_plot</span><span class=p>(</span><span class=n>features</span><span class=p>,</span> <span class=n>name</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    This function creates violin plots of features given in the argument.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># Create query</span>
</span></span><span class=line><span class=cl>    <span class=n>query</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>features</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>query</span> <span class=o>+=</span> <span class=s2>&#34;features == &#39;&#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&#34;&#39; or &#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>query</span> <span class=o>=</span> <span class=n>query</span><span class=p>[</span><span class=mi>0</span><span class=p>:</span> <span class=o>-</span><span class=mi>4</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Create data for visualization</span>
</span></span><span class=line><span class=cl>    <span class=n>plotdata</span> <span class=o>=</span> <span class=n>data_scaled_melt</span><span class=o>.</span><span class=n>query</span><span class=p>(</span><span class=n>query</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Plot figure</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>12</span><span class=p>,</span> <span class=mi>6</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>sns</span><span class=o>.</span><span class=n>violinplot</span><span class=p>(</span><span class=n>x</span><span class=o>=</span><span class=s1>&#39;features&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                   <span class=n>y</span><span class=o>=</span><span class=s1>&#39;value&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                   <span class=n>hue</span><span class=o>=</span><span class=s1>&#39;disease&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                   <span class=n>data</span><span class=o>=</span><span class=n>plotdata</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                   <span class=n>split</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                   <span class=n>inner</span><span class=o>=</span><span class=s2>&#34;quart&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>xticks</span><span class=p>(</span><span class=n>rotation</span><span class=o>=</span><span class=mi>45</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>title</span><span class=p>(</span><span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>xlabel</span><span class=p>(</span><span class=s2>&#34;Features&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>ylabel</span><span class=p>(</span><span class=s2>&#34;Relative Abundance&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>violin_plot</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>columns</span><span class=p>[</span><span class=mi>1</span><span class=p>:</span><span class=mi>11</span><span class=p>],</span> <span class=s2>&#34;Violin Plot of the First 10 Features&#34;</span><span class=p>)</span>
</span></span></code></pre></div><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://raw.githubusercontent.com/HuaZou/Image_Host/main/img/08.PredictiveModelRandomForest_15_0.png alt loading=lazy data-zoomable></div></div></figure></p><ul><li>swarm plot</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>%%</span><span class=n>capture</span> <span class=o>--</span><span class=n>no</span><span class=o>-</span><span class=n>display</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>swarm_plot</span><span class=p>(</span><span class=n>features</span><span class=p>,</span> <span class=n>name</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    This function creates swarm plots of features given in the argument.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># Create query</span>
</span></span><span class=line><span class=cl>    <span class=n>query</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>features</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>query</span> <span class=o>+=</span> <span class=s2>&#34;features == &#39;&#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&#34;&#39; or &#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>query</span> <span class=o>=</span> <span class=n>query</span><span class=p>[</span><span class=mi>0</span><span class=p>:</span><span class=o>-</span><span class=mi>4</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Create data for visualization</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=n>data_scaled_melt</span><span class=o>.</span><span class=n>query</span><span class=p>(</span><span class=n>query</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Plot figure</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>12</span><span class=p>,</span> <span class=mi>6</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>sns</span><span class=o>.</span><span class=n>swarmplot</span><span class=p>(</span><span class=n>x</span><span class=o>=</span><span class=s1>&#39;features&#39;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                  <span class=n>y</span><span class=o>=</span><span class=s1>&#39;value&#39;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                  <span class=n>hue</span><span class=o>=</span><span class=s1>&#39;disease&#39;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                  <span class=n>data</span><span class=o>=</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>xticks</span><span class=p>(</span><span class=n>rotation</span><span class=o>=</span><span class=mi>45</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>title</span><span class=p>(</span><span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>xlabel</span><span class=p>(</span><span class=s2>&#34;Features&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>ylabel</span><span class=p>(</span><span class=s2>&#34;Relative Abundance&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>swarm_plot</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>columns</span><span class=p>[</span><span class=mi>1</span><span class=p>:</span><span class=mi>11</span><span class=p>],</span> <span class=s2>&#34;Swarm Plot of the First 10 Features&#34;</span><span class=p>)</span>
</span></span></code></pre></div><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://raw.githubusercontent.com/HuaZou/Image_Host/main/img/08.PredictiveModelRandomForest_17_0.png alt loading=lazy data-zoomable></div></div></figure></p><ul><li>boxplot</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>box_plot</span><span class=p>(</span><span class=n>features</span><span class=p>,</span> <span class=n>name</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    This function creates box plots of features given in the argument.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># Create query</span>
</span></span><span class=line><span class=cl>    <span class=n>query</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>features</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>query</span> <span class=o>+=</span> <span class=s2>&#34;features == &#39;&#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&#34;&#39; or &#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>query</span> <span class=o>=</span> <span class=n>query</span><span class=p>[</span><span class=mi>0</span><span class=p>:</span><span class=o>-</span><span class=mi>4</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Create data for visualization</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=n>data_scaled_melt</span><span class=o>.</span><span class=n>query</span><span class=p>(</span><span class=n>query</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Plot figure</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>12</span><span class=p>,</span> <span class=mi>6</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>sns</span><span class=o>.</span><span class=n>boxplot</span><span class=p>(</span><span class=n>x</span><span class=o>=</span><span class=s1>&#39;features&#39;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                <span class=n>y</span><span class=o>=</span><span class=s1>&#39;value&#39;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                <span class=n>hue</span><span class=o>=</span><span class=s1>&#39;disease&#39;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                <span class=n>data</span><span class=o>=</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>xticks</span><span class=p>(</span><span class=n>rotation</span><span class=o>=</span><span class=mi>45</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>title</span><span class=p>(</span><span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>xlabel</span><span class=p>(</span><span class=s2>&#34;Features&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>ylabel</span><span class=p>(</span><span class=s2>&#34;Relative Abundance&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>box_plot</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>columns</span><span class=p>[</span><span class=mi>1</span><span class=p>:</span><span class=mi>11</span><span class=p>],</span> <span class=s2>&#34;Box Plot of the First 10 Features&#34;</span><span class=p>)</span>
</span></span></code></pre></div><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://raw.githubusercontent.com/HuaZou/Image_Host/main/img/08.PredictiveModelRandomForest_19_0.png alt loading=lazy data-zoomable></div></div></figure></p><p>The violin plot is very efficient in comparing distributions of different variables. The classification becomes clear in the swarm plot. Finally, the box plots are useful in comparing median and detecing outliers.</p><p>From above plots we can draw some insights from the data:</p><ul><li><p>The median of some features are very different between &lsquo;healthy&rsquo; and &lsquo;CRC&rsquo;. This seperation can be seen clearly in the box plots. They can be very good features for classification. For examples: <em>s__Faecalibacterium_prausnitzii</em>.</p></li><li><p>However, there are distributions looking similar between &lsquo;healthy&rsquo; and &lsquo;CRC&rsquo;. For examples: <em>s__Bacteroides_plebeius</em>. These features are weak in classifying data.</p></li><li><p>Some features have similar distributions, thus might be highly correlated with each other. We should not include all these hightly correlated varibles in our predicting model.</p></li></ul><h2 id=correlation>Correlation</h2><p>As discussed above, some dependent variables in the dataset might be highly correlated with each other. Let&rsquo;s explore the correlation of three examples above.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>correlation</span><span class=p>(</span><span class=n>data_frame</span><span class=p>,</span> <span class=n>var</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    1. Print correlation
</span></span></span><span class=line><span class=cl><span class=s2>    2. Create jointplot
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># Print correlation</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Correlation: &#34;</span><span class=p>,</span> <span class=n>data_frame</span><span class=p>[[</span><span class=n>var</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>var</span><span class=p>[</span><span class=mi>1</span><span class=p>]]]</span><span class=o>.</span><span class=n>corr</span><span class=p>()</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Create jointplot</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>6</span><span class=p>,</span> <span class=mi>6</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>sns</span><span class=o>.</span><span class=n>jointplot</span><span class=p>(</span><span class=n>data</span> <span class=o>=</span> <span class=n>data_frame</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=n>x</span> <span class=o>=</span> <span class=n>var</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>                  <span class=n>y</span> <span class=o>=</span> <span class=n>var</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>                  <span class=n>kind</span><span class=o>=</span><span class=s1>&#39;reg&#39;</span><span class=p>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>%%</span><span class=n>capture</span> <span class=o>--</span><span class=n>no</span><span class=o>-</span><span class=n>display</span>
</span></span><span class=line><span class=cl><span class=n>correlation</span><span class=p>(</span><span class=n>data_scaled</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;s__Gordonibacter_pamelaeae&#39;</span><span class=p>,</span> <span class=s1>&#39;s__Eggerthella_lenta&#39;</span><span class=p>])</span>
</span></span></code></pre></div><pre><code>&lt;Figure size 600x600 with 0 Axes&gt;
</code></pre><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://raw.githubusercontent.com/HuaZou/Image_Host/main/img/08.PredictiveModelRandomForest_23_1.png alt loading=lazy data-zoomable></div></div></figure></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>%%</span><span class=n>capture</span> <span class=o>--</span><span class=n>no</span><span class=o>-</span><span class=n>display</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Create correlation matrix</span>
</span></span><span class=line><span class=cl><span class=n>corr_mat</span> <span class=o>=</span> <span class=n>data_scaled</span><span class=o>.</span><span class=n>iloc</span><span class=p>[:,</span> <span class=mi>1</span><span class=p>:</span><span class=mi>100</span><span class=p>]</span><span class=o>.</span><span class=n>corr</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Create mask</span>
</span></span><span class=line><span class=cl><span class=n>mask</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros_like</span><span class=p>(</span><span class=n>corr_mat</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>bool</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>mask</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>triu_indices_from</span><span class=p>(</span><span class=n>mask</span><span class=p>,</span> <span class=n>k</span><span class=o>=</span><span class=mi>1</span><span class=p>)]</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Plot heatmap</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>15</span><span class=p>,</span> <span class=mi>10</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>heatmap</span><span class=p>(</span><span class=n>corr_mat</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=n>annot</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=n>fmt</span><span class=o>=</span><span class=s1>&#39;.1f&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>cmap</span><span class=o>=</span><span class=s1>&#39;RdBu_r&#39;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=n>vmin</span><span class=o>=-</span><span class=mi>1</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=n>vmax</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>mask</span><span class=o>=</span><span class=n>mask</span><span class=p>)</span>
</span></span></code></pre></div><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://raw.githubusercontent.com/HuaZou/Image_Host/main/img/08.PredictiveModelRandomForest_24_1.png alt loading=lazy data-zoomable></div></div></figure></p><p>From the heat map, we can see that many variables in the dataset are highly correlated. What are variables having correlation greater than 0.5?</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>15</span><span class=p>,</span> <span class=mi>10</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>heatmap</span><span class=p>(</span><span class=n>corr_mat</span><span class=p>[</span><span class=n>corr_mat</span> <span class=o>&gt;</span> <span class=mf>0.5</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>            <span class=n>annot</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>fmt</span><span class=o>=</span><span class=s1>&#39;.1f&#39;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=n>cmap</span><span class=o>=</span><span class=n>sns</span><span class=o>.</span><span class=n>cubehelix_palette</span><span class=p>(</span><span class=mi>200</span><span class=p>),</span> 
</span></span><span class=line><span class=cl>            <span class=n>mask</span><span class=o>=</span><span class=n>mask</span><span class=p>)</span>
</span></span></code></pre></div><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://raw.githubusercontent.com/HuaZou/Image_Host/main/img/08.PredictiveModelRandomForest_26_1.png alt loading=lazy data-zoomable></div></div></figure></p><h2 id=feature-selection>Feature Selection</h2><p>Using Univariate Feature Selection <a href=https://scikit-learn.org/stable/modules/generated/sklearn.feature_selection.SelectKBest.html#sklearn.feature_selection.SelectKBest target=_blank rel=noopener>(sklearn.feature_selection.SelectKBest)</a> to choose N features with the k highest scores.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.feature_selection</span> <span class=kn>import</span> <span class=n>SelectKBest</span><span class=p>,</span> <span class=n>f_classif</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>df_features</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>iloc</span><span class=p>[:,</span> <span class=mi>1</span><span class=p>:]</span>
</span></span><span class=line><span class=cl><span class=n>df_disease</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;disease&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>feature_selection</span> <span class=o>=</span> <span class=n>SelectKBest</span><span class=p>(</span><span class=n>f_classif</span><span class=p>,</span> <span class=n>k</span><span class=o>=</span><span class=mi>100</span><span class=p>)</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>df_features</span><span class=p>,</span> <span class=n>df_disease</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>selected_features</span> <span class=o>=</span> <span class=n>df_features</span><span class=o>.</span><span class=n>columns</span><span class=p>[</span><span class=n>feature_selection</span><span class=o>.</span><span class=n>get_support</span><span class=p>()]</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;The N selected features are: &#34;</span><span class=p>,</span> <span class=nb>list</span><span class=p>(</span><span class=n>selected_features</span><span class=p>))</span>
</span></span></code></pre></div><pre><code>The N selected features are:  ['s__Bacteroides_plebeius', 's__Bacteroides_dorei', 's__Faecalibacterium_prausnitzii', 's__Eubacterium_eligens', 's__Bacteroides_ovatus', 's__Parabacteroides_distasonis', 's__Phascolarctobacterium_faecium', 's__Bacteroides_uniformis', 's__Bifidobacterium_longum', 's__Collinsella_aerofaciens', 's__Clostridium_sp_CAG_58', 's__Blautia_wexlerae', 's__Fusicatenibacter_saccharivorans', 's__Eggerthella_lenta', 's__Clostridium_bolteae_CAG_59', 's__Streptococcus_salivarius', 's__Coprococcus_catus', 's__Erysipelatoclostridium_ramosum', 's__Haemophilus_parainfluenzae', 's__Holdemania_filiformis', 's__Turicibacter_sanguinis', 's__Clostridium_symbiosum', 's__Ruthenibacterium_lactatiformans', 's__Sellimonas_intestinalis', 's__Bilophila_wadsworthia', 's__Butyricimonas_synergistica', 's__Parabacteroides_goldsteinii', 's__Anaerotignum_lactatifermentans', 's__Anaerotruncus_colihominis', 's__Intestinibacter_bartlettii', 's__Eisenbergiella_tayi', 's__Prevotella_copri', 's__Clostridium_asparagiforme', 's__Alistipes_indistinctus', 's__Rothia_mucilaginosa', 's__Gemmiger_formicilis', 's__Streptococcus_mitis', 's__Butyricimonas_virosa', 's__Clostridium_aldenense', 's__Alistipes_shahii', 's__Clostridium_spiroforme', 's__Streptococcus_infantis', 's__Lachnospira_pectinoschiza', 's__Eubacterium_rectale', 's__Roseburia_intestinalis', 's__Ruminococcus_bromii', 's__Roseburia_inulinivorans', 's__Anaerostipes_hadrus', 's__Ruminococcus_torques', 's__Roseburia_faecis', 's__Phascolarctobacterium_succinatutens', 's__Megamonas_funiformis', 's__Parabacteroides_merdae', 's__Ruminococcus_bicirculans', 's__Eubacterium_ventriosum', 's__Eubacterium_sp_CAG_38', 's__Dorea_longicatena', 's__Eubacterium_sp_CAG_274', 's__Coprococcus_comes', 's__Bacteroides_caccae', 's__Bacteroides_sp_CAG_144', 's__Odoribacter_splanchnicus', 's__Slackia_isoflavoniconvertens', 's__Bifidobacterium_pseudocatenulatum', 's__Megamonas_hypermegale', 's__Bacteroides_xylanisolvens', 's__Roseburia_hominis', 's__Asaccharobacter_celatus', 's__Adlercreutzia_equolifaciens', 's__Bacteroides_cellulosilyticus', 's__Coprobacter_fastidiosus', 's__Streptococcus_australis', 's__Akkermansia_muciniphila', 's__Streptococcus_thermophilus', 's__Parasutterella_excrementihominis', 's__Allisonella_histaminiformans', 's__Mogibacterium_diversum', 's__Streptococcus_oralis', 's__Eubacterium_sulci', 's__Gemella_sanguinis', 's__Actinomyces_odontolyticus', 's__Gemella_haemolysans', 's__Megasphaera_micronuciformis', 's__Actinomyces_sp_HMSC035G02', 's__Clostridium_clostridioforme', 's__Klebsiella_variicola', 's__Parvimonas_micra', 's__Holdemanella_biformis', 's__Paraprevotella_xylaniphila', 's__Streptococcus_vestibularis', 's__Fusobacterium_mortiferum', 's__Bifidobacterium_dentium', 's__Bacteroides_finegoldii', 's__Clostridium_saccharolyticum', 's__Streptococcus_anginosus_group', 's__Streptococcus_sp_A12', 's__Bacteroides_coprocola', 's__Ruminococcus_lactaris', 's__Turicimonas_muris', 's__Proteobacteria_bacterium_CAG_139']
</code></pre><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>data_selected</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>feature_selection</span><span class=o>.</span><span class=n>transform</span><span class=p>(</span><span class=n>df_features</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                 <span class=n>columns</span><span class=o>=</span><span class=n>selected_features</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>data_selected</span><span class=o>.</span><span class=n>head</span><span class=p>()</span>
</span></span></code></pre></div><div><style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}<pre><code>.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</code></pre><p></style></p><table border=1 class=dataframe><thead><tr style=text-align:right><th></th><th>s__Bacteroides_plebeius</th><th>s__Bacteroides_dorei</th><th>s__Faecalibacterium_prausnitzii</th><th>s__Eubacterium_eligens</th><th>s__Bacteroides_ovatus</th><th>s__Parabacteroides_distasonis</th><th>s__Phascolarctobacterium_faecium</th><th>s__Bacteroides_uniformis</th><th>s__Bifidobacterium_longum</th><th>s__Collinsella_aerofaciens</th><th>...</th><th>s__Fusobacterium_mortiferum</th><th>s__Bifidobacterium_dentium</th><th>s__Bacteroides_finegoldii</th><th>s__Clostridium_saccharolyticum</th><th>s__Streptococcus_anginosus_group</th><th>s__Streptococcus_sp_A12</th><th>s__Bacteroides_coprocola</th><th>s__Ruminococcus_lactaris</th><th>s__Turicimonas_muris</th><th>s__Proteobacteria_bacterium_CAG_139</th></tr></thead><tbody><tr><th>0</th><td>10.262146</td><td>8.532694</td><td>7.729839</td><td>7.605931</td><td>7.477464</td><td>7.267232</td><td>6.832596</td><td>6.738413</td><td>6.717971</td><td>6.576766</td><td>...</td><td>-3.441779</td><td>-3.441779</td><td>-3.441779</td><td>-3.441779</td><td>-3.441779</td><td>-3.441779</td><td>-3.441779</td><td>-3.441779</td><td>-3.441779</td><td>-3.441779</td></tr><tr><th>1</th><td>7.609333</td><td>4.466872</td><td>6.654823</td><td>4.236672</td><td>4.697277</td><td>3.518645</td><td>-3.929140</td><td>5.619399</td><td>4.429797</td><td>4.532923</td><td>...</td><td>-3.929140</td><td>-3.929140</td><td>-3.929140</td><td>-3.929140</td><td>-3.929140</td><td>-3.929140</td><td>-3.929140</td><td>-3.929140</td><td>-3.929140</td><td>-3.929140</td></tr><tr><th>2</th><td>8.411267</td><td>7.884081</td><td>7.668467</td><td>-3.379905</td><td>6.577229</td><td>6.474488</td><td>-3.379905</td><td>6.725545</td><td>-3.379905</td><td>-3.379905</td><td>...</td><td>-3.379905</td><td>-3.379905</td><td>-3.379905</td><td>-3.379905</td><td>-3.379905</td><td>-3.379905</td><td>-3.379905</td><td>-3.379905</td><td>-3.379905</td><td>-3.379905</td></tr><tr><th>3</th><td>6.261269</td><td>6.939669</td><td>5.819509</td><td>4.064784</td><td>4.026179</td><td>7.227381</td><td>-3.632294</td><td>6.170285</td><td>3.089479</td><td>5.897842</td><td>...</td><td>3.295942</td><td>1.107104</td><td>-3.632294</td><td>-3.632294</td><td>-3.632294</td><td>-3.632294</td><td>-3.632294</td><td>-3.632294</td><td>-3.632294</td><td>-3.632294</td></tr><tr><th>4</th><td>-0.026692</td><td>5.697435</td><td>3.808831</td><td>4.253082</td><td>4.284986</td><td>5.784833</td><td>-5.007660</td><td>5.492187</td><td>3.893588</td><td>4.759592</td><td>...</td><td>-5.007660</td><td>-5.007660</td><td>4.187313</td><td>2.219946</td><td>0.713786</td><td>-5.007660</td><td>-5.007660</td><td>-5.007660</td><td>-5.007660</td><td>-5.007660</td></tr></tbody></table><p>5 rows × 100 columns</p></div><p>Removing variables with high colinearity</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>correlation</span><span class=p>(</span><span class=n>dataset</span><span class=p>,</span> <span class=n>threshold</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>col_corr</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span> <span class=c1># Set of all the names of deleted columns</span>
</span></span><span class=line><span class=cl>    <span class=n>corr_matrix</span> <span class=o>=</span> <span class=n>dataset</span><span class=o>.</span><span class=n>corr</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>corr_matrix</span><span class=o>.</span><span class=n>columns</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>i</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>corr_matrix</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=n>j</span><span class=p>]</span> <span class=o>&gt;=</span> <span class=n>threshold</span><span class=p>)</span> <span class=ow>and</span> <span class=p>(</span><span class=n>corr_matrix</span><span class=o>.</span><span class=n>columns</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>col_corr</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=n>colname</span> <span class=o>=</span> <span class=n>corr_matrix</span><span class=o>.</span><span class=n>columns</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=c1># getting the name of column</span>
</span></span><span class=line><span class=cl>                <span class=n>col_corr</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>colname</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>colname</span> <span class=ow>in</span> <span class=n>dataset</span><span class=o>.</span><span class=n>columns</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>del</span> <span class=n>dataset</span><span class=p>[</span><span class=n>colname</span><span class=p>]</span> <span class=c1># deleting the column from the dataset</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>correlation</span><span class=p>(</span><span class=n>data_selected</span><span class=p>,</span> <span class=mf>0.6</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>data_selected</span><span class=o>.</span><span class=n>shape</span>
</span></span></code></pre></div><p>To see how different these features are in &lsquo;CRC&rsquo; and in &lsquo;healthy&rsquo; by pairplot.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>pairplot</span><span class=p>(</span><span class=n>pd</span><span class=o>.</span><span class=n>concat</span><span class=p>([</span><span class=n>data_selected</span><span class=p>,</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;disease&#39;</span><span class=p>]],</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>),</span> <span class=n>hue</span><span class=o>=</span><span class=s1>&#39;disease&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://raw.githubusercontent.com/HuaZou/Image_Host/main/img/08.PredictiveModelRandomForest_31_1.png alt loading=lazy data-zoomable></div></div></figure></p><h2 id=principal-component-analysis>Principal component analysis</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.decomposition</span> <span class=kn>import</span> <span class=n>PCA</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>pca</span> <span class=o>=</span> <span class=n>PCA</span><span class=p>(</span><span class=n>n_components</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>pca</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>data_selected</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>data_selected_pca</span> <span class=o>=</span> <span class=n>pca</span><span class=o>.</span><span class=n>transform</span><span class=p>(</span><span class=n>data_selected</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>PCA_df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>PCA_df</span><span class=p>[</span><span class=s1>&#39;PCA_1&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>data_selected_pca</span><span class=p>[:,</span> <span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>PCA_df</span><span class=p>[</span><span class=s1>&#39;PCA_2&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>data_selected_pca</span><span class=p>[:,</span> <span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span> <span class=mi>8</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>scatterplot</span><span class=p>(</span><span class=n>data</span> <span class=o>=</span> <span class=n>PCA_df</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>x</span> <span class=o>=</span> <span class=s1>&#39;PCA_1&#39;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                <span class=n>y</span> <span class=o>=</span> <span class=s1>&#39;PCA_2&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>hue</span><span class=o>=</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;disease&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>title</span><span class=p>(</span><span class=s2>&#34;PCA&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>xlabel</span><span class=p>(</span><span class=s2>&#34;First Principal Component&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>ylabel</span><span class=p>(</span><span class=s2>&#34;Second Principal Component&#34;</span><span class=p>)</span>
</span></span></code></pre></div><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://raw.githubusercontent.com/HuaZou/Image_Host/main/img/08.PredictiveModelRandomForest_33_1.png alt loading=lazy data-zoomable></div></div></figure></p><h2 id=transforming-the-string-label-into-numeric-lable>Transforming the string label into numeric lable</h2><p>The RandomForestClassifier in sklearn does not accept string labels for categorical variables.</p><ul><li>0 = Healthy = Healthy Control</li><li>1 = CRC = Colorectal Cancer</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>data</span><span class=p>[</span><span class=s1>&#39;disease&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;disease&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>map</span><span class=p>({</span><span class=s1>&#39;healthy&#39;</span><span class=p>:</span><span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;CRC&#39;</span><span class=p>:</span><span class=mi>1</span><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=n>data</span><span class=o>.</span><span class=n>head</span><span class=p>(</span><span class=n>n</span><span class=o>=</span><span class=mi>6</span><span class=p>)</span>
</span></span></code></pre></div><div><style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}<pre><code>.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</code></pre><p></style></p><table border=1 class=dataframe><thead><tr style=text-align:right><th></th><th>disease</th><th>s__Bacteroides_plebeius</th><th>s__Bacteroides_dorei</th><th>s__Faecalibacterium_prausnitzii</th><th>s__Eubacterium_eligens</th><th>s__Bacteroides_ovatus</th><th>s__Parabacteroides_distasonis</th><th>s__Ruminococcus_gnavus</th><th>s__Phascolarctobacterium_faecium</th><th>s__Bacteroides_uniformis</th><th>...</th><th>s__Bacteroides_finegoldii</th><th>s__Haemophilus_sp_HMSC71H05</th><th>s__Clostridium_saccharolyticum</th><th>s__Streptococcus_anginosus_group</th><th>s__Streptococcus_sp_A12</th><th>s__Klebsiella_pneumoniae</th><th>s__Bacteroides_coprocola</th><th>s__Ruminococcus_lactaris</th><th>s__Turicimonas_muris</th><th>s__Proteobacteria_bacterium_CAG_139</th></tr></thead><tbody><tr><th>0</th><td>0</td><td>10.262146</td><td>8.532694</td><td>7.729839</td><td>7.605931</td><td>7.477464</td><td>7.267232</td><td>7.074996</td><td>6.832596</td><td>6.738413</td><td>...</td><td>-3.441779</td><td>-3.441779</td><td>-3.441779</td><td>-3.441779</td><td>-3.441779</td><td>-3.441779</td><td>-3.441779</td><td>-3.441779</td><td>-3.441779</td><td>-3.441779</td></tr><tr><th>1</th><td>0</td><td>7.609333</td><td>4.466872</td><td>6.654823</td><td>4.236672</td><td>4.697277</td><td>3.518645</td><td>2.603642</td><td>-3.929140</td><td>5.619399</td><td>...</td><td>-3.929140</td><td>-3.929140</td><td>-3.929140</td><td>-3.929140</td><td>-3.929140</td><td>-3.929140</td><td>-3.929140</td><td>-3.929140</td><td>-3.929140</td><td>-3.929140</td></tr><tr><th>2</th><td>0</td><td>8.411267</td><td>7.884081</td><td>7.668467</td><td>-3.379905</td><td>6.577229</td><td>6.474488</td><td>6.883446</td><td>-3.379905</td><td>6.725545</td><td>...</td><td>-3.379905</td><td>-3.379905</td><td>-3.379905</td><td>-3.379905</td><td>-3.379905</td><td>-3.379905</td><td>-3.379905</td><td>-3.379905</td><td>-3.379905</td><td>-3.379905</td></tr><tr><th>3</th><td>0</td><td>6.261269</td><td>6.939669</td><td>5.819509</td><td>4.064784</td><td>4.026179</td><td>7.227381</td><td>3.407265</td><td>-3.632294</td><td>6.170285</td><td>...</td><td>-3.632294</td><td>-3.632294</td><td>-3.632294</td><td>-3.632294</td><td>-3.632294</td><td>-3.632294</td><td>-3.632294</td><td>-3.632294</td><td>-3.632294</td><td>-3.632294</td></tr><tr><th>4</th><td>1</td><td>-0.026692</td><td>5.697435</td><td>3.808831</td><td>4.253082</td><td>4.284986</td><td>5.784833</td><td>6.384592</td><td>-5.007660</td><td>5.492187</td><td>...</td><td>4.187313</td><td>2.872359</td><td>2.219946</td><td>0.713786</td><td>-5.007660</td><td>-5.007660</td><td>-5.007660</td><td>-5.007660</td><td>-5.007660</td><td>-5.007660</td></tr><tr><th>5</th><td>1</td><td>-0.655056</td><td>-1.760058</td><td>7.171883</td><td>-1.760058</td><td>0.737587</td><td>7.421635</td><td>7.857269</td><td>6.762199</td><td>3.025669</td><td>...</td><td>-1.760058</td><td>-1.760058</td><td>2.682819</td><td>-1.760058</td><td>-0.364194</td><td>-1.760058</td><td>-1.760058</td><td>-1.760058</td><td>-1.760058</td><td>-1.760058</td></tr></tbody></table><p>6 rows × 152 columns</p></div><h2 id=creating-train-and-test-sets>Creating Train and Test Sets</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>X</span> <span class=o>=</span> <span class=n>data_selected</span>
</span></span><span class=line><span class=cl><span class=n>Y</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;disease&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>x_train</span><span class=p>,</span> <span class=n>x_test</span><span class=p>,</span> <span class=n>y_train</span><span class=p>,</span> <span class=n>y_test</span> <span class=o>=</span> <span class=n>train_test_split</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>X</span><span class=p>,</span> <span class=n>Y</span><span class=p>,</span> <span class=n>test_size</span> <span class=o>=</span> <span class=mf>0.30</span><span class=p>,</span> <span class=n>random_state</span> <span class=o>=</span> <span class=mi>42</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># Cleaning test sets to avoid future warning messages</span>
</span></span><span class=line><span class=cl><span class=n>y_train</span> <span class=o>=</span> <span class=n>y_train</span><span class=o>.</span><span class=n>values</span><span class=o>.</span><span class=n>ravel</span><span class=p>()</span> 
</span></span><span class=line><span class=cl><span class=n>y_test</span> <span class=o>=</span> <span class=n>y_test</span><span class=o>.</span><span class=n>values</span><span class=o>.</span><span class=n>ravel</span><span class=p>()</span>  
</span></span></code></pre></div><h2 id=fitting-random-forest>Fitting Random Forest</h2><ul><li><strong>n_estimators</strong>: The number of decision tree</li><li><strong>max_depth</strong>: The maximum splits for all trees in the forest.</li><li><strong>bootstrap</strong>: An indicator of whether or not we want to use bootstrap samples when building trees.</li><li><strong>max_features</strong>: The maximum number of features that will be used in node splitting.</li><li><strong>criterion</strong>: This is the metric used to asses the stopping criteria for the decision trees.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1>#%%capture --no-display</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>fit_rfc</span> <span class=o>=</span> <span class=n>RandomForestClassifier</span><span class=p>(</span><span class=n>random_state</span><span class=o>=</span><span class=mi>123</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>seed</span><span class=p>(</span><span class=mi>123</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>start</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># hyperparameters Optimzation</span>
</span></span><span class=line><span class=cl><span class=n>param_grid</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;n_estimators&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mi>200</span><span class=p>,</span> <span class=mi>500</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;max_features&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;auto&#39;</span><span class=p>,</span> <span class=s1>&#39;sqrt&#39;</span><span class=p>,</span> <span class=s1>&#39;log2&#39;</span><span class=p>,</span> <span class=kc>None</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;bootstrap&#39;</span><span class=p>:</span> <span class=p>[</span><span class=kc>True</span><span class=p>,</span> <span class=kc>False</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;max_depth&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;criterion&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;gini&#39;</span><span class=p>,</span> <span class=s1>&#39;entropy&#39;</span><span class=p>,</span> <span class=s1>&#39;log_loss&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># tuning parameters</span>
</span></span><span class=line><span class=cl><span class=n>cv_rfc</span> <span class=o>=</span> <span class=n>GridSearchCV</span><span class=p>(</span><span class=n>estimator</span> <span class=o>=</span> <span class=n>fit_rfc</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=n>param_grid</span><span class=o>=</span><span class=n>param_grid</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=n>cv</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=n>n_jobs</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>cv_rfc</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>X</span><span class=o>=</span><span class=n>x_train</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=n>y_train</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Best Parameters using grid search: </span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>cv_rfc</span><span class=o>.</span><span class=n>best_params_</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>end</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Time taken in grid search: </span><span class=si>{0: .2f}</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>end</span> <span class=o>-</span> <span class=n>start</span><span class=p>))</span>
</span></span></code></pre></div><pre><code>Best Parameters using grid search: 
 {'bootstrap': False, 'criterion': 'gini', 'max_depth': 4, 'max_features': 'auto', 'n_estimators': 200}
Time taken in grid search:  273.51
</code></pre><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>fit_rfc</span><span class=o>.</span><span class=n>set_params</span><span class=p>(</span><span class=n>bootstrap</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                   <span class=n>criterion</span> <span class=o>=</span> <span class=s1>&#39;gini&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                   <span class=n>max_features</span> <span class=o>=</span> <span class=s1>&#39;auto&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                   <span class=n>max_depth</span> <span class=o>=</span> <span class=mi>4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                   <span class=n>n_estimators</span> <span class=o>=</span> <span class=mi>200</span><span class=p>)</span>
</span></span></code></pre></div><pre><code>RandomForestClassifier(max_depth=4, n_estimators=200, oob_score=True,
                       random_state=123, warm_start=True)
</code></pre><h2 id=out-of-bag-error-rate>Out of Bag Error Rate</h2><blockquote><p>Another useful feature of random forest is the concept of an out-of-bag (OOB) error rate. Because only two-thirds of the data are used to train each tree when building the forest, one-third of unseen data can be used in a way that is advantageous to our accuracy metrics without being as computationally expensive as something like cross validation, for instance.</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>%%</span><span class=n>capture</span> <span class=o>--</span><span class=n>no</span><span class=o>-</span><span class=n>display</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>fit_rfc</span><span class=o>.</span><span class=n>set_params</span><span class=p>(</span><span class=n>warm_start</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                   <span class=n>oob_score</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>min_estimators</span> <span class=o>=</span> <span class=mi>15</span>
</span></span><span class=line><span class=cl><span class=n>max_estimators</span> <span class=o>=</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>error_rate</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>min_estimators</span><span class=p>,</span> <span class=n>max_estimators</span> <span class=o>+</span> <span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>fit_rfc</span><span class=o>.</span><span class=n>set_params</span><span class=p>(</span><span class=n>n_estimators</span> <span class=o>=</span> <span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>fit_rfc</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>x_train</span><span class=p>,</span> <span class=n>y_train</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>oob_error</span> <span class=o>=</span> <span class=mi>1</span> <span class=o>-</span> <span class=n>fit_rfc</span><span class=o>.</span><span class=n>oob_score_</span>
</span></span><span class=line><span class=cl>    <span class=n>error_rate</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>oob_error</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>oob_series</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>(</span><span class=n>error_rate</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>fig</span><span class=p>,</span> <span class=n>ax</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>subplots</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span> <span class=mi>10</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ax</span><span class=o>.</span><span class=n>set_facecolor</span><span class=p>(</span><span class=s1>&#39;#fafafa&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>oob_series</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>kind</span><span class=o>=</span><span class=s1>&#39;line&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>color</span> <span class=o>=</span> <span class=s1>&#39;red&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>axhline</span><span class=p>(</span><span class=mf>0.4</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=n>color</span><span class=o>=</span><span class=s1>&#39;#875FDB&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>linestyle</span><span class=o>=</span><span class=s1>&#39;--&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>axhline</span><span class=p>(</span><span class=mf>0.34</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=n>color</span><span class=o>=</span><span class=s1>&#39;#875FDB&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>linestyle</span><span class=o>=</span><span class=s1>&#39;--&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>xlabel</span><span class=p>(</span><span class=s1>&#39;n_estimators&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>ylabel</span><span class=p>(</span><span class=s1>&#39;OOB Error Rate&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>title</span><span class=p>(</span><span class=s1>&#39;OOB Error Rate Across various Forest sizes </span><span class=se>\n</span><span class=s1>(From 15 to 1000 trees)&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://raw.githubusercontent.com/HuaZou/Image_Host/main/img/08.PredictiveModelRandomForest_42_1.png alt loading=lazy data-zoomable></div></div></figure></p><p>​</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;OOB Error rate for 200 trees is: </span><span class=si>{0:.5f}</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>oob_series</span><span class=p>[</span><span class=mi>200</span><span class=p>]))</span>
</span></span></code></pre></div><pre><code>OOB Error rate for 200 trees is: 0.38352
</code></pre><h2 id=building-model-of-optimal-parameters>Building model of optimal parameters</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>rfc_final</span> <span class=o>=</span> <span class=n>RandomForestClassifier</span><span class=p>(</span><span class=n>bootstrap</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                   <span class=n>criterion</span> <span class=o>=</span> <span class=s1>&#39;gini&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                   <span class=n>max_features</span> <span class=o>=</span> <span class=s1>&#39;auto&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                   <span class=n>max_depth</span> <span class=o>=</span> <span class=mi>4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                   <span class=n>n_estimators</span> <span class=o>=</span> <span class=mi>200</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                                   <span class=n>random_state</span> <span class=o>=</span> <span class=mi>123</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>rfc_final</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>x_train</span><span class=p>,</span> <span class=n>y_train</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>classifier_score</span> <span class=o>=</span> <span class=n>rfc_final</span><span class=o>.</span><span class=n>score</span><span class=p>(</span><span class=n>x_train</span><span class=p>,</span> <span class=n>y_train</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>The classifier accuracy score is </span><span class=si>{:03.2f}</span><span class=se>\n</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>classifier_score</span><span class=p>))</span>
</span></span></code></pre></div><pre><code>The classifier accuracy score is 0.95
</code></pre><h3 id=the-performance-of-model-on-testdata>The performance of model on testData</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>%%</span><span class=n>capture</span> <span class=o>--</span><span class=n>no</span><span class=o>-</span><span class=n>display</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>%</span><span class=n>matplotlib</span> <span class=n>inline</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>matplotlib.pyplot</span> <span class=k>as</span> <span class=nn>plt</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>IPython.display</span> <span class=kn>import</span> <span class=n>Image</span><span class=p>,</span> <span class=n>display</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn</span> <span class=kn>import</span> <span class=n>metrics</span><span class=p>,</span> <span class=n>preprocessing</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>predicted</span> <span class=o>=</span> <span class=n>rfc_final</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>x_test</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>accuracy</span> <span class=o>=</span> <span class=n>accuracy_score</span><span class=p>(</span><span class=n>y_test</span><span class=p>,</span> <span class=n>predicted</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>cm</span> <span class=o>=</span> <span class=n>metrics</span><span class=o>.</span><span class=n>confusion_matrix</span><span class=p>(</span><span class=n>y_test</span><span class=p>,</span> <span class=n>predicted</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>fig</span><span class=p>,</span> <span class=n>ax</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>subplots</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=mi>5</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>ax</span><span class=o>.</span><span class=n>matshow</span><span class=p>(</span><span class=n>cm</span><span class=p>,</span> <span class=n>cmap</span><span class=o>=</span><span class=n>plt</span><span class=o>.</span><span class=n>cm</span><span class=o>.</span><span class=n>Reds</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>cm</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>     <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>cm</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>1</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>         <span class=n>ax</span><span class=o>.</span><span class=n>text</span><span class=p>(</span><span class=n>x</span><span class=o>=</span><span class=n>j</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=n>i</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>s</span><span class=o>=</span><span class=n>cm</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=n>j</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>                <span class=n>va</span><span class=o>=</span><span class=s1>&#39;center&#39;</span><span class=p>,</span> <span class=n>ha</span><span class=o>=</span><span class=s1>&#39;center&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>xlabel</span><span class=p>(</span><span class=s1>&#39;Predicted Values&#39;</span><span class=p>,</span> <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>ylabel</span><span class=p>(</span><span class=s1>&#39;Actual Values&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ax</span><span class=o>.</span><span class=n>set_xticklabels</span><span class=p>([</span><span class=s1>&#39;&#39;</span><span class=p>]</span> <span class=o>+</span> <span class=p>[</span><span class=s1>&#39;Healthy&#39;</span><span class=p>,</span> <span class=s2>&#34;CRC&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>ax</span><span class=o>.</span><span class=n>set_yticklabels</span><span class=p>([</span><span class=s1>&#39;&#39;</span><span class=p>]</span> <span class=o>+</span> <span class=p>[</span><span class=s1>&#39;Healthy&#39;</span><span class=p>,</span> <span class=s2>&#34;CRC&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></span></code></pre></div><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://raw.githubusercontent.com/HuaZou/Image_Host/main/img/08.PredictiveModelRandomForest_47_0.png alt loading=lazy data-zoomable></div></div></figure></p><h2 id=roc-curve-metrics>ROC Curve Metrics</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># We grab the second array from the output which corresponds to</span>
</span></span><span class=line><span class=cl><span class=c1># to the predicted probabilites of positive classes </span>
</span></span><span class=line><span class=cl><span class=c1># Ordered wrt fit.classes_ in our case [0, 1] where 1 is our positive class</span>
</span></span><span class=line><span class=cl><span class=n>predictions_prob</span> <span class=o>=</span> <span class=n>rfc_final</span><span class=o>.</span><span class=n>predict_proba</span><span class=p>(</span><span class=n>x_test</span><span class=p>)[:,</span> <span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>fpr2</span><span class=p>,</span> <span class=n>tpr2</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>roc_curve</span><span class=p>(</span><span class=n>y_test</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                          <span class=n>predictions_prob</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                          <span class=n>pos_label</span> <span class=o>=</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>auc_rf</span> <span class=o>=</span> <span class=n>auc</span><span class=p>(</span><span class=n>fpr2</span><span class=p>,</span> <span class=n>tpr2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;The AUC for model is: </span><span class=si>{0: .4f}</span><span class=s2>&#34;</span> <span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>auc_rf</span><span class=p>))</span>
</span></span></code></pre></div><pre><code>The AUC for model is:  0.6653
</code></pre><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>plot_roc_curve</span><span class=p>(</span><span class=n>fpr</span><span class=p>,</span> <span class=n>tpr</span><span class=p>,</span> <span class=n>auc</span><span class=p>,</span> <span class=n>estimator</span><span class=p>,</span> <span class=n>xlim</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>ylim</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Purpose
</span></span></span><span class=line><span class=cl><span class=s2>    ----------
</span></span></span><span class=line><span class=cl><span class=s2>    Function creates ROC Curve for respective model given selected parameters.
</span></span></span><span class=line><span class=cl><span class=s2>    Optional x and y limits to zoom into graph
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    Parameters
</span></span></span><span class=line><span class=cl><span class=s2>    ----------
</span></span></span><span class=line><span class=cl><span class=s2>    * fpr: Array returned from sklearn.metrics.roc_curve for increasing
</span></span></span><span class=line><span class=cl><span class=s2>            false positive rates
</span></span></span><span class=line><span class=cl><span class=s2>    * tpr: Array returned from sklearn.metrics.roc_curve for increasing
</span></span></span><span class=line><span class=cl><span class=s2>            true positive rates
</span></span></span><span class=line><span class=cl><span class=s2>    * auc: Float returned from sklearn.metrics.auc (Area under Curve)
</span></span></span><span class=line><span class=cl><span class=s2>    * estimator: String represenation of appropriate model, can only contain the
</span></span></span><span class=line><span class=cl><span class=s2>    following: [&#39;knn&#39;, &#39;rf&#39;, &#39;nn&#39;]
</span></span></span><span class=line><span class=cl><span class=s2>    * xlim: Set upper and lower x-limits
</span></span></span><span class=line><span class=cl><span class=s2>    * ylim: Set upper and lower y-limits
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>my_estimators</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;knn&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;Kth Nearest Neighbor&#39;</span><span class=p>,</span> <span class=s1>&#39;deeppink&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>              <span class=s1>&#39;rf&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;Random Forest&#39;</span><span class=p>,</span> <span class=s1>&#39;red&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>              <span class=s1>&#39;nn&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;Neural Network&#39;</span><span class=p>,</span> <span class=s1>&#39;purple&#39;</span><span class=p>]}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>plot_title</span> <span class=o>=</span> <span class=n>my_estimators</span><span class=p>[</span><span class=n>estimator</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>color_value</span> <span class=o>=</span> <span class=n>my_estimators</span><span class=p>[</span><span class=n>estimator</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>KeyError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;&#39;</span><span class=si>{0}</span><span class=s2>&#39; does not correspond with the appropriate key inside the estimators dictionary. </span><span class=se>\
</span></span></span><span class=line><span class=cl><span class=se>\n</span><span class=s2>Please refer to function to check `my_estimators` dictionary.&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>estimator</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>fig</span><span class=p>,</span> <span class=n>ax</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>subplots</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span> <span class=mi>10</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>ax</span><span class=o>.</span><span class=n>set_facecolor</span><span class=p>(</span><span class=s1>&#39;#fafafa&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>fpr</span><span class=p>,</span> <span class=n>tpr</span><span class=p>,</span>
</span></span><span class=line><span class=cl>             <span class=n>color</span><span class=o>=</span><span class=n>color_value</span><span class=p>,</span>
</span></span><span class=line><span class=cl>             <span class=n>linewidth</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>title</span><span class=p>(</span><span class=s1>&#39;ROC Curve For </span><span class=si>{0}</span><span class=s1> (AUC = </span><span class=si>{1: 0.3f}</span><span class=s1>)&#39;</span>\
</span></span><span class=line><span class=cl>              <span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>plot_title</span><span class=p>,</span> <span class=n>auc</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>([</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>],</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>],</span> <span class=s1>&#39;k--&#39;</span><span class=p>,</span> <span class=n>lw</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span> <span class=c1># Add Diagonal line</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>([</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>],</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>],</span> <span class=s1>&#39;k--&#39;</span><span class=p>,</span> <span class=n>lw</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>color</span> <span class=o>=</span> <span class=s1>&#39;black&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>],</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>],</span> <span class=s1>&#39;k--&#39;</span><span class=p>,</span> <span class=n>lw</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>color</span> <span class=o>=</span> <span class=s1>&#39;black&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>xlim</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>plt</span><span class=o>.</span><span class=n>xlim</span><span class=p>(</span><span class=o>*</span><span class=n>xlim</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>ylim</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>plt</span><span class=o>.</span><span class=n>ylim</span><span class=p>(</span><span class=o>*</span><span class=n>ylim</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>xlabel</span><span class=p>(</span><span class=s1>&#39;False Positive Rate&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>ylabel</span><span class=p>(</span><span class=s1>&#39;True Positive Rate&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plot_roc_curve</span><span class=p>(</span><span class=n>fpr2</span><span class=p>,</span> <span class=n>tpr2</span><span class=p>,</span> <span class=n>auc_rf</span><span class=p>,</span> <span class=s1>&#39;rf&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>               <span class=n>xlim</span><span class=o>=</span><span class=p>(</span><span class=o>-</span><span class=mf>0.01</span><span class=p>,</span> <span class=mf>1.05</span><span class=p>),</span> 
</span></span><span class=line><span class=cl>               <span class=n>ylim</span><span class=o>=</span><span class=p>(</span><span class=mf>0.001</span><span class=p>,</span> <span class=mf>1.05</span><span class=p>))</span>
</span></span></code></pre></div><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://raw.githubusercontent.com/HuaZou/Image_Host/main/img/08.PredictiveModelRandomForest_50_1.png alt loading=lazy data-zoomable></div></div></figure></p><h2 id=classification-report>Classification Report</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>print_class_report</span><span class=p>(</span><span class=n>predictions</span><span class=p>,</span> <span class=n>alg_name</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Purpose
</span></span></span><span class=line><span class=cl><span class=s2>    ----------
</span></span></span><span class=line><span class=cl><span class=s2>    Function helps automate the report generated by the
</span></span></span><span class=line><span class=cl><span class=s2>    sklearn package. Useful for multiple model comparison
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    Parameters:
</span></span></span><span class=line><span class=cl><span class=s2>    ----------
</span></span></span><span class=line><span class=cl><span class=s2>    predictions: The predictions made by the algorithm used
</span></span></span><span class=line><span class=cl><span class=s2>    alg_name: String containing the name of the algorithm used
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    Returns:
</span></span></span><span class=line><span class=cl><span class=s2>    ----------
</span></span></span><span class=line><span class=cl><span class=s2>    Returns classification report generated from sklearn. 
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Classification Report for </span><span class=si>{0}</span><span class=s1>:&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>alg_name</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>classification_report</span><span class=p>(</span><span class=n>predictions</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=n>y_test</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=n>target_names</span> <span class=o>=</span> <span class=n>dx</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>dx</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;Healthy&#39;</span><span class=p>,</span> <span class=s2>&#34;CRC&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>class_report</span> <span class=o>=</span> <span class=n>print_class_report</span><span class=p>(</span><span class=n>predicted</span><span class=p>,</span> <span class=s1>&#39;Random Forest&#39;</span><span class=p>)</span>
</span></span></code></pre></div><pre><code>Classification Report for Random Forest:
              precision    recall  f1-score   support

     Healthy       0.76      0.61      0.68        89
         CRC       0.57      0.73      0.64        63

    accuracy                           0.66       152
   macro avg       0.66      0.67      0.66       152
weighted avg       0.68      0.66      0.66       152
</code></pre><h2 id=feature-importance>Feature Importance</h2><p>Until now, I have used all the features given in the model. Now, I will select only the important features, build the model using these features and see its effect on accuracy.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>feature_scores</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>(</span><span class=n>rfc_final</span><span class=o>.</span><span class=n>feature_importances_</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                           <span class=n>index</span><span class=o>=</span><span class=n>x_train</span><span class=o>.</span><span class=n>columns</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                           <span class=n>name</span><span class=o>=</span><span class=s1>&#39;Importance&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>sort_values</span><span class=p>(</span><span class=n>ascending</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>feature_scores</span>
</span></span></code></pre></div><pre><code>s__Roseburia_faecis                    0.054408
s__Parvimonas_micra                    0.038683
s__Collinsella_aerofaciens             0.028716
s__Bacteroides_cellulosilyticus        0.022687
s__Proteobacteria_bacterium_CAG_139    0.021398
                                         ...   
s__Clostridium_symbiosum               0.003134
s__Bacteroides_uniformis               0.003102
s__Bacteroides_coprocola               0.002990
s__Megamonas_hypermegale               0.002715
s__Alistipes_indistinctus              0.002612
Name: Importance, Length: 100, dtype: float64
</code></pre><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>f</span><span class=p>,</span> <span class=n>ax</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>subplots</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span> <span class=mi>6</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>ax</span> <span class=o>=</span> <span class=n>sns</span><span class=o>.</span><span class=n>barplot</span><span class=p>(</span><span class=n>x</span><span class=o>=</span><span class=n>feature_scores</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=n>feature_scores</span><span class=o>.</span><span class=n>index</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ax</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s2>&#34;Visualize feature scores of the features&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ax</span><span class=o>.</span><span class=n>set_yticklabels</span><span class=p>(</span><span class=n>feature_scores</span><span class=o>.</span><span class=n>index</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ax</span><span class=o>.</span><span class=n>set_xlabel</span><span class=p>(</span><span class=s2>&#34;Feature importance score&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ax</span><span class=o>.</span><span class=n>set_ylabel</span><span class=p>(</span><span class=s2>&#34;Features&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></span></code></pre></div><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://raw.githubusercontent.com/HuaZou/Image_Host/main/img/08.PredictiveModelRandomForest_55_0.png alt loading=lazy data-zoomable></div></div></figure></p><h3 id=selecting-features-by-importance>Selecting features by importance</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>feature_scores</span><span class=o>.</span><span class=n>to_frame</span><span class=p>()</span>
</span></span></code></pre></div><div><style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}<pre><code>.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</code></pre><p></style></p><table border=1 class=dataframe><thead><tr style=text-align:right><th></th><th>Importance</th></tr></thead><tbody><tr><th>s__Roseburia_faecis</th><td>0.054408</td></tr><tr><th>s__Parvimonas_micra</th><td>0.038683</td></tr><tr><th>s__Collinsella_aerofaciens</th><td>0.028716</td></tr><tr><th>s__Bacteroides_cellulosilyticus</th><td>0.022687</td></tr><tr><th>s__Proteobacteria_bacterium_CAG_139</th><td>0.021398</td></tr><tr><th>...</th><td>...</td></tr><tr><th>s__Clostridium_symbiosum</th><td>0.003134</td></tr><tr><th>s__Bacteroides_uniformis</th><td>0.003102</td></tr><tr><th>s__Bacteroides_coprocola</th><td>0.002990</td></tr><tr><th>s__Megamonas_hypermegale</th><td>0.002715</td></tr><tr><th>s__Alistipes_indistinctus</th><td>0.002612</td></tr></tbody></table><p>100 rows × 1 columns</p></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>selected_features_imp</span> <span class=o>=</span> <span class=n>feature_scores</span><span class=o>.</span><span class=n>to_frame</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>selected_features_imp</span> <span class=o>=</span> <span class=n>selected_features_imp</span><span class=p>[</span><span class=n>selected_features_imp</span><span class=p>[</span><span class=s1>&#39;Importance&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mf>0.01</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>selected_features_imp</span>
</span></span></code></pre></div><div><style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}<pre><code>.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</code></pre><p></style></p><table border=1 class=dataframe><thead><tr style=text-align:right><th></th><th>Importance</th></tr></thead><tbody><tr><th>s__Roseburia_faecis</th><td>0.054408</td></tr><tr><th>s__Parvimonas_micra</th><td>0.038683</td></tr><tr><th>s__Collinsella_aerofaciens</th><td>0.028716</td></tr><tr><th>s__Bacteroides_cellulosilyticus</th><td>0.022687</td></tr><tr><th>s__Proteobacteria_bacterium_CAG_139</th><td>0.021398</td></tr><tr><th>s__Parasutterella_excrementihominis</th><td>0.020249</td></tr><tr><th>s__Coprobacter_fastidiosus</th><td>0.019776</td></tr><tr><th>s__Eubacterium_eligens</th><td>0.019302</td></tr><tr><th>s__Bacteroides_plebeius</th><td>0.019007</td></tr><tr><th>s__Streptococcus_anginosus_group</th><td>0.018813</td></tr><tr><th>s__Lachnospira_pectinoschiza</th><td>0.018070</td></tr><tr><th>s__Actinomyces_sp_HMSC035G02</th><td>0.016633</td></tr><tr><th>s__Parabacteroides_goldsteinii</th><td>0.016162</td></tr><tr><th>s__Alistipes_shahii</th><td>0.015669</td></tr><tr><th>s__Faecalibacterium_prausnitzii</th><td>0.015090</td></tr><tr><th>s__Bacteroides_dorei</th><td>0.014330</td></tr><tr><th>s__Bifidobacterium_pseudocatenulatum</th><td>0.014211</td></tr><tr><th>s__Turicimonas_muris</th><td>0.013414</td></tr><tr><th>s__Roseburia_intestinalis</th><td>0.013204</td></tr><tr><th>s__Bacteroides_xylanisolvens</th><td>0.012800</td></tr><tr><th>s__Rothia_mucilaginosa</th><td>0.012791</td></tr><tr><th>s__Bifidobacterium_longum</th><td>0.012468</td></tr><tr><th>s__Streptococcus_mitis</th><td>0.012383</td></tr><tr><th>s__Mogibacterium_diversum</th><td>0.011902</td></tr><tr><th>s__Blautia_wexlerae</th><td>0.011741</td></tr><tr><th>s__Eubacterium_sulci</th><td>0.011740</td></tr><tr><th>s__Clostridium_clostridioforme</th><td>0.011074</td></tr><tr><th>s__Eubacterium_sp_CAG_38</th><td>0.011013</td></tr><tr><th>s__Eubacterium_rectale</th><td>0.010855</td></tr><tr><th>s__Erysipelatoclostridium_ramosum</th><td>0.010849</td></tr><tr><th>s__Anaerostipes_hadrus</th><td>0.010746</td></tr><tr><th>s__Ruminococcus_lactaris</th><td>0.010473</td></tr><tr><th>s__Actinomyces_odontolyticus</th><td>0.010403</td></tr><tr><th>s__Clostridium_sp_CAG_58</th><td>0.010365</td></tr></tbody></table></div><h2 id=rebuilding-model>Rebuilding model</h2><p>Using the selected features to rebuild the model</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># dataset</span>
</span></span><span class=line><span class=cl><span class=n>X_rebuild</span> <span class=o>=</span> <span class=n>data_selected</span><span class=p>[</span><span class=n>selected_features_imp</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>to_list</span><span class=p>()]</span>
</span></span><span class=line><span class=cl><span class=n>Y</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;disease&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># data splition</span>
</span></span><span class=line><span class=cl><span class=n>x_train</span><span class=p>,</span> <span class=n>x_test</span><span class=p>,</span> <span class=n>y_train</span><span class=p>,</span> <span class=n>y_test</span> <span class=o>=</span> <span class=n>train_test_split</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>X_rebuild</span><span class=p>,</span> <span class=n>Y</span><span class=p>,</span> <span class=n>test_size</span> <span class=o>=</span> <span class=mf>0.30</span><span class=p>,</span> <span class=n>random_state</span> <span class=o>=</span> <span class=mi>42</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>## Cleaning test sets to avoid future warning messages</span>
</span></span><span class=line><span class=cl><span class=n>y_train</span> <span class=o>=</span> <span class=n>y_train</span><span class=o>.</span><span class=n>values</span><span class=o>.</span><span class=n>ravel</span><span class=p>()</span> 
</span></span><span class=line><span class=cl><span class=n>y_test</span> <span class=o>=</span> <span class=n>y_test</span><span class=o>.</span><span class=n>values</span><span class=o>.</span><span class=n>ravel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># build model</span>
</span></span><span class=line><span class=cl><span class=n>rfc_rebuild</span> <span class=o>=</span> <span class=n>RandomForestClassifier</span><span class=p>(</span><span class=n>bootstrap</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                     <span class=n>criterion</span> <span class=o>=</span> <span class=s1>&#39;gini&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                     <span class=n>max_features</span> <span class=o>=</span> <span class=s1>&#39;auto&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                     <span class=n>max_depth</span> <span class=o>=</span> <span class=mi>4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                     <span class=n>n_estimators</span> <span class=o>=</span> <span class=mi>200</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                                     <span class=n>random_state</span> <span class=o>=</span> <span class=mi>123</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>rfc_rebuild</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>x_train</span><span class=p>,</span> <span class=n>y_train</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>classifier_score_rebuild</span> <span class=o>=</span> <span class=n>rfc_rebuild</span><span class=o>.</span><span class=n>score</span><span class=p>(</span><span class=n>x_train</span><span class=p>,</span> <span class=n>y_train</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>The classifier accuracy score is </span><span class=si>{:03.2f}</span><span class=se>\n</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>classifier_score_rebuild</span><span class=p>))</span>
</span></span></code></pre></div><pre><code>The classifier accuracy score is 0.91
</code></pre><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>%%</span><span class=n>capture</span> <span class=o>--</span><span class=n>no</span><span class=o>-</span><span class=n>display</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>%</span><span class=n>matplotlib</span> <span class=n>inline</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>matplotlib.pyplot</span> <span class=k>as</span> <span class=nn>plt</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>IPython.display</span> <span class=kn>import</span> <span class=n>Image</span><span class=p>,</span> <span class=n>display</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn</span> <span class=kn>import</span> <span class=n>metrics</span><span class=p>,</span> <span class=n>preprocessing</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>predicted</span> <span class=o>=</span> <span class=n>rfc_rebuild</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>x_test</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>accuracy</span> <span class=o>=</span> <span class=n>accuracy_score</span><span class=p>(</span><span class=n>y_test</span><span class=p>,</span> <span class=n>predicted</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>cm</span> <span class=o>=</span> <span class=n>metrics</span><span class=o>.</span><span class=n>confusion_matrix</span><span class=p>(</span><span class=n>y_test</span><span class=p>,</span> <span class=n>predicted</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>fig</span><span class=p>,</span> <span class=n>ax</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>subplots</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=mi>5</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>ax</span><span class=o>.</span><span class=n>matshow</span><span class=p>(</span><span class=n>cm</span><span class=p>,</span> <span class=n>cmap</span><span class=o>=</span><span class=n>plt</span><span class=o>.</span><span class=n>cm</span><span class=o>.</span><span class=n>Reds</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>cm</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>     <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>cm</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>1</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>         <span class=n>ax</span><span class=o>.</span><span class=n>text</span><span class=p>(</span><span class=n>x</span><span class=o>=</span><span class=n>j</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=n>i</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>s</span><span class=o>=</span><span class=n>cm</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=n>j</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>                <span class=n>va</span><span class=o>=</span><span class=s1>&#39;center&#39;</span><span class=p>,</span> <span class=n>ha</span><span class=o>=</span><span class=s1>&#39;center&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>xlabel</span><span class=p>(</span><span class=s1>&#39;Predicted Values&#39;</span><span class=p>,</span> <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>ylabel</span><span class=p>(</span><span class=s1>&#39;Actual Values&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ax</span><span class=o>.</span><span class=n>set_xticklabels</span><span class=p>([</span><span class=s1>&#39;&#39;</span><span class=p>]</span> <span class=o>+</span> <span class=p>[</span><span class=s1>&#39;Healthy&#39;</span><span class=p>,</span> <span class=s2>&#34;CRC&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>ax</span><span class=o>.</span><span class=n>set_yticklabels</span><span class=p>([</span><span class=s1>&#39;&#39;</span><span class=p>]</span> <span class=o>+</span> <span class=p>[</span><span class=s1>&#39;Healthy&#39;</span><span class=p>,</span> <span class=s2>&#34;CRC&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></span></code></pre></div><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://raw.githubusercontent.com/HuaZou/Image_Host/main/img/08.PredictiveModelRandomForest_61_0.png alt loading=lazy data-zoomable></div></div></figure></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>predictions_prob</span> <span class=o>=</span> <span class=n>rfc_rebuild</span><span class=o>.</span><span class=n>predict_proba</span><span class=p>(</span><span class=n>x_test</span><span class=p>)[:,</span> <span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>fpr2</span><span class=p>,</span> <span class=n>tpr2</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>roc_curve</span><span class=p>(</span><span class=n>y_test</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                          <span class=n>predictions_prob</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                          <span class=n>pos_label</span> <span class=o>=</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>auc_rf</span> <span class=o>=</span> <span class=n>auc</span><span class=p>(</span><span class=n>fpr2</span><span class=p>,</span> <span class=n>tpr2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;The AUC for model is: </span><span class=si>{0: .4f}</span><span class=s2>&#34;</span> <span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>auc_rf</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plot_roc_curve</span><span class=p>(</span><span class=n>fpr2</span><span class=p>,</span> <span class=n>tpr2</span><span class=p>,</span> <span class=n>auc_rf</span><span class=p>,</span> <span class=s1>&#39;rf&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>               <span class=n>xlim</span><span class=o>=</span><span class=p>(</span><span class=o>-</span><span class=mf>0.01</span><span class=p>,</span> <span class=mf>1.05</span><span class=p>),</span> 
</span></span><span class=line><span class=cl>               <span class=n>ylim</span><span class=o>=</span><span class=p>(</span><span class=mf>0.001</span><span class=p>,</span> <span class=mf>1.05</span><span class=p>))</span>
</span></span></code></pre></div><pre><code>The AUC for model is:  0.6792
</code></pre><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://raw.githubusercontent.com/HuaZou/Image_Host/main/img/08.PredictiveModelRandomForest_62_2.png alt loading=lazy data-zoomable></div></div></figure></p><h2 id=summary>Summary</h2><p>Random Forest classification predictive modeling from end-to-end using Python.</p><ol><li>Exploratory Data analysis.</li><li>Feature selection.</li><li>Tune Parameters.</li><li>Performance Evaluation.</li><li>The optimal features for rebuilding model.</li><li>Finalize results</li></ol><h2 id=reference>Reference</h2><ul><li><a href=https://github.com/chriskhanhtran/predict-breast-cancer-with-rf-pca-svm target=_blank rel=noopener>Predict Breast Cancer with Random Forest, PCA and SVM</a></li></ul></article><style>.btn-feedback{display:inline-block}.btn-feedback-negative{margin-left:1em}.feedback--response{display:none;margin-top:1em}.feedback--response__visible{display:block}</style><div class="d-print-none widget--feedback"><h2 class=feedback--title>Feedback</h2><p class=feedback--question>Was this page helpful?</p><p class="feedback--response feedback--response-positive">🙏</p><p class="feedback--response feedback--response-negative">🙏</p><button class="btn btn-primary mb-4 btn-feedback btn-feedback-positive">
😍 Yes</button>
<button class="btn btn-primary mb-4 btn-feedback btn-feedback-negative">
😡 No</button></div><script>const btnYes=document.querySelector(".btn-feedback-positive"),btnNo=document.querySelector(".btn-feedback-negative"),responseYes=document.querySelector(".feedback--response-positive"),responseNo=document.querySelector(".feedback--response-negative"),disableButtons=()=>{btnYes.disabled=!0,btnNo.disabled=!0},sendFeedback=e=>{if(typeof gtag!="function")return;gtag("event","click",{event_category:"page_rating",event_label:window.location.pathname,value:e,transport_type:"beacon",event_callback:function(){console.debug(`✅ Feedback sent ${e}`)}})};btnYes.addEventListener("click",()=>{console.debug("Feedback response: 😍"),responseYes.classList.add("feedback--response__visible"),disableButtons(),sendFeedback(1)}),btnNo.addEventListener("click",()=>{console.debug("Feedback response: 😡"),responseNo.classList.add("feedback--response__visible"),disableButtons(),sendFeedback(0)})</script><div class=article-tags><a class="badge badge-light" href=/tag/machine-learning/>machine learning</a>
<a class="badge badge-light" href=/tag/microbiota/>microbiota</a></div><div class=article-widget><div class=post-nav><div class=post-nav-item><div class=meta-nav>Previous</div><a href=/post/tool/2022-11-10-metagenomics/ rel=next>How to download taxa profile of multiple samples</a></div><div class=post-nav-item><div class=meta-nav>Next</div><a href=/post/machine_learning/2022-11-02-ml008-compclassifier/ rel=prev>Machine Learning on gut microbiota of patients with Colorectal cancer (8)</a></div></div></div></div><div class=body-footer><p>Last updated on Nov 3, 2022</p></div><footer class=site-footer><p class=powered-by>© 2023 Hua Zou &#183;
Rendered by <a href=https://cran.r-project.org/ target=_blank rel=noopener><i class="fab fa-r-project"></i> </a><a href=https://github.com/rstudio/blogdown target=_blank rel=noopener>blogdown</a> ,
<a href=https://sourcethemes.com/academic/ target=_blank rel=noopener>Academic theme</a> and
<a href=https://gohugo.io target=_blank rel=noopener>Hugo</a>.
<span class=float-right aria-hidden=true><a href=# id=back_to_top><span class=button_icon><i class="fas fa-chevron-up fa-2x"></i></span></a></span></p></footer><script type=text/javascript src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></main></div></div></div><div class=page-footer></div><script src=/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js></script>
<script src=https://cdn.jsdelivr.net/gh/bryanbraun/anchorjs@4.2.2/anchor.min.js integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin=anonymous></script>
<script>anchors.add()</script><script id=page-data type=application/json>{"use_headroom":false}</script><script src=/en/js/wowchemy.min.e973d49cb2d568aa6f8eaf3638337473.js></script><div id=modal class="modal fade" role=dialog><div class=modal-dialog><div class=modal-content><div class=modal-header><h5 class=modal-title>Cite</h5><button type=button class=close data-dismiss=modal aria-label=Close>
<span aria-hidden=true>&#215;</span></button></div><div class=modal-body><pre><code></code></pre></div><div class=modal-footer><a class="btn btn-outline-primary my-1 js-copy-cite" href=# target=_blank><i class="fas fa-copy"></i> Copy</a>
<a class="btn btn-outline-primary my-1 js-download-cite" href=# target=_blank><i class="fas fa-download"></i> Download</a><div id=modal-error></div></div></div></div></div><script src=/js/wowchemy-publication.68f8d7090562ca65fc6d3cb3f8f2d2cb.js type=module></script></body></html>